---
- name: reset iptables
  sudo: yes
  command: iptables --flush
  args:
    creates: /etc/iptables.ansible

- name: ensure iptables are ran only once
  sudo: yes
  file:
    path: /etc/iptables.ansible
    owner: root
    group: root
    state: touch

- name: install docker
  sudo: yes
  yum:
    pkg: docker
    state: latest

- name: start docker
  sudo: yes
  service:
    name: docker
    enabled: yes
    state: started

- name: add common services
  sudo: yes
  with_items: common_services
  template:
    src: "{{ item.name }}.service.j2"
    dest: "/lib/systemd/system/{{ item.name }}.service"
    owner: root
    group: root

- name: reload systemd
  sudo: yes
  command: systemctl daemon-reload

- name: start common services
  sudo: yes
  with_items: common_services
  service:
    name: "{{ item.name }}"
    enabled: yes
    state: started

- name: install common packages
  sudo: yes
  with_items: common_packages
  yum:
    pkg: "{{ item.name }}"
    state: latest
